{
   "name": "Trip Diary Introduction",
   "type": "section",
   "uuid": "ee92c75b-4ff9-4fef-bf18-1b56f17dec29",
   "items": [
      {
         "name": "Page One",
         "type": "set",
         "items": [
            {
               "type": "markdown",
               "text": "## Introduction page\n\n### About this survey\n\nThis survey is being conducted by the UiTR lab\n\n&nbsp;\n\n### Instructions\n\n - Add members of your family\n - Record trips taken every day, for each family member \n\n&nbsp;\n\n### Privacy\n\n - your data is hosted on secure servers at UBC\n - your data will only be accessed by approved researchers\n&nbsp;\n\n&nbsp;\n\n&nbsp;\n\n"
            },
            {
               "type": "html",
               "html": "<h2>Hello world {{now|date(\"F jS\")}}</h2>"
            }
         ]
      }
   ],
   "navigationLogic": "return '4b7f0';",
   "then": "goto node 0",
   "nodes": [
      {
         "name": "Family Member Details",
         "type": "section",
         "uuid": "4b7f002f-f8cd-41a4-8a0c-ab56b6b2a488",
         "items": [
            {
               "name": "Page One",
               "type": "set",
               "items": [
                  {
                     "type": "defaultData",
                     "data": "{\n\"loop\":{\"i\":0, \"total\":1},\n\"memberDetails\":[]\n}"
                  },
                  {
                     "type": "script",
                     "script": "\n  renderer.useFormDataFieldArray(\"memberDetails\", formData.loop.i)\n\n\n"
                  },
                  {
                     "type": "markdown",
                     "text": "\n\n{% set indexNumbers = [ 'First', 'Second' ,'Third', 'Fourth', 'Fifth', 'Sixth', 'Seventh', 'Eighth', 'This is ridiculous-th'] %}\n\n\n\n# Person Profile: {{indexNumbers[loop.i]}} Household Member\n\n\n&nbsp;\n&nbsp;\n\n> please add a profile for each person in the household.\n\n&nbsp;\n&nbsp;\n"
                  },
                  {
                     "fieldName": "personName{{loop.i}}",
                     "type": "textfield",
                     "label": "Person Name",
                     "placeholder": "add name or initial"
                  },
                  {
                     "type": "fieldset",
                     "legend": "Some Legend",
                     "items": [
                        {
                           "fieldName": "gender{{loop.i}}",
                           "type": "radio",
                           "values": "male, female",
                           "defaultValue": "",
                           "labels": "Male, Female",
                           "default": "none",
                           "label": "{{loop.i}} Gender of this person"
                        },
                        {
                           "fieldName": "age{{loop.i}}",
                           "type": "textfield",
                           "label": "Age of this person",
                           "placeholder": "years"
                        },
                        {
                           "fieldName": "hasLicense{{loop.i}}",
                           "value": "Some Value",
                           "type": "checkbox",
                           "label": "Person has a valid driver's license?",
                           "defaultValue": false,
                           "default": false,
                           "trueLabel": "Yes",
                           "falseLabel": "No"
                        },
                        {
                           "fieldName": "isComercialDriver{{loop.i}}",
                           "value": "Some Value",
                           "type": "checkbox",
                           "label": "Person is employed as a commercial driver",
                           "defaultValue": false,
                           "default": false,
                           "trueLabel": "Yes",
                           "falseLabel": "No"
                        },
                        {
                           "type": "label",
                           "text": "This person is: (Check all that apply)"
                        },
                        {
                           "fieldName": "someOptionA{{loop.i}}",
                           "value": "Some Value",
                           "type": "checkbox",
                           "label": "Yes",
                           "defaultValue": false,
                           "default": false,
                           "trueLabel": "Yes",
                           "falseLabel": "No"
                        },
                        {
                           "fieldName": "someOptionB{{loop.i}}",
                           "value": "Some Value",
                           "type": "checkbox",
                           "label": "Yes",
                           "defaultValue": false,
                           "default": false,
                           "trueLabel": "Yes",
                           "falseLabel": "No"
                        }
                     ]
                  },
                  {
                     "type": "fieldset",
                     "legend": "",
                     "items": [
                        {
                           "type": "label",
                           "text": "If this person works, please list thier workplaces"
                        },
                        {
                           "fieldName": "work1_{{loop.i}}",
                           "type": "textfield",
                           "label": "Name of work 1",
                           "placeholder": ""
                        },
                        {
                           "fieldName": "address1_{{loop.i}}",
                           "type": "textfield",
                           "label": "Address",
                           "placeholder": "answer here"
                        },
                        {
                           "fieldName": "municipality1_{{loop.i}}",
                           "type": "textfield",
                           "label": "Municipality",
                           "placeholder": "answer here"
                        },
                        {
                           "fieldName": "work2_{{loop.i}}",
                           "type": "textfield",
                           "label": "Name of work 2",
                           "placeholder": ""
                        },
                        {
                           "fieldName": "address2_{{loop.i}}",
                           "type": "textfield",
                           "label": "Address",
                           "placeholder": "answer here"
                        },
                        {
                           "fieldName": "municipality2_{{loop.i}}",
                           "type": "textfield",
                           "label": "Municipality",
                           "placeholder": "answer here"
                        }
                     ]
                  },
                  {
                     "type": "fieldset",
                     "legend": "Some legend",
                     "items": [
                        {
                           "type": "label",
                           "text": "If this person is a student, please list thier school"
                        },
                        {
                           "fieldName": "school{{loop.i}}",
                           "type": "textfield",
                           "label": "Name of School",
                           "placeholder": ""
                        },
                        {
                           "fieldName": "addressSchool{{loop.i}}",
                           "type": "textfield",
                           "label": "Address",
                           "placeholder": ""
                        },
                        {
                           "fieldName": "municipalitySchool{{loop.i}}",
                           "type": "textfield",
                           "label": "Municipality",
                           "placeholder": ""
                        }
                     ]
                  },
                  {
                     "type": "fieldset",
                     "legend": "",
                     "items": [
                        {
                           "type": "label",
                           "text": "Does this person drive him/herself to work or school?"
                        },
                        {
                           "fieldName": "drives{{loop.i}}",
                           "value": "Some Value",
                           "type": "checkbox",
                           "label": "Yes",
                           "defaultValue": false,
                           "default": false,
                           "showYesNo": "on",
                           "trueLabel": "Yes",
                           "falseLabel": "No"
                        },
                        {
                           "fieldName": "paysParking{{loop.i}}",
                           "type": "radio",
                           "values": "free, employer, partial-employer, personal",
                           "defaultValue": "",
                           "labels": "Parking is free, Fully paid for by employee, partial-employer, personal",
                           "default": "none",
                           "label": "Who pays for parking?"
                        }
                     ]
                  },
                  {
                     "fieldName": "addAnother",
                     "value": "Some Value",
                     "type": "checkbox",
                     "label": "Add Another Family Member",
                     "defaultValue": false,
                     "trueLabel": "Yes",
                     "falseLabel": "No",
                     "showYesNo": "on"
                  }
               ]
            }
         ],
         "navigationLogic": "\n//reset form nested loops\nrenderer.useFormData();\n\nif(formData.memberDetails[formData.loop.i].addAnother==='on'){\n  var loop=renderer.getFormValue('loop');\n  if(typeof loop=='undefined'){\n    loop={i:-1, total:1};\n  }\n  loop.i++;\n  loop.total++;\n  renderer.setFormValue('loop', loop);\n  renderer.setFormValue('addAnother', 'off');\n  return '4b7f0';\n}\n\nvar loop=renderer.getFormValue('loop');\nloop.i=0;\nrenderer.setFormValue('loop', loop);\n\nreturn 'cb46d';",
         "then": "goto node 0",
         "nodes": [
            "cb46d44e-248c-4297-bcf3-e3955220b7a2",
            "4b7f002f-f8cd-41a4-8a0c-ab56b6b2a488"
         ]
      },
      {
         "name": "Check Member Trips",
         "type": "section",
         "uuid": "cb46d44e-248c-4297-bcf3-e3955220b7a2",
         "items": [
            {
               "name": "Page One",
               "type": "set",
               "items": [
                  {
                     "type": "defaultData",
                     "data": "{\n\"tripDetails\":[]\n}"
                  },
                  {
                     "type": "script",
                     "script": "\n  renderer.useFormDataFieldArray(\"tripDetails\", formData.loop.i)\n\n\n"
                  },
                  {
                     "type": "markdown",
                     "text": "## Record trips for {{now|date(\"F jS\")}}\n### Did **{{memberDetails[loop.i]['personName' ~ loop.i]}}** make any trips today"
                  },
                  {
                     "fieldName": "madeTrips",
                     "value": "Some Value",
                     "type": "checkbox",
                     "label": "Yes they did",
                     "defaultValue": false,
                     "trueLabel": "Yes",
                     "falseLabel": "No"
                  }
               ]
            }
         ],
         "navigationLogic": "if(formData.tripDetails[formData.loop.i].madeTrips==='on'){\n   return '6478e';\n}\nrenderer.useFormData();\nif(formData.loop.i<formData.loop.total-1){\n   formData.loop.i++;\n   renderer.setFormValue('loop', formData.loop);\n   return 'cb46d';\n}\nreturn '8f6f3';",
         "then": "goto node 0",
         "nodes": [
            {
               "name": "Trips Made By Member",
               "type": "section",
               "uuid": "6478e134-dd4b-4be6-be7a-415aecbfbe09",
               "items": [
                  {
                     "name": "Page One",
                     "type": "set",
                     "items": [
                        {
                           "type": "markdown",
                           "text": "## Record trips for **{{_context['personName' ~ loop.i]}}** on {{now|date(\"F jS\")}}\n"
                        },
                        {
                           "type": "fieldset",
                           "legend": "Some legend",
                           "items": [
                              {
                                 "fieldName": "started{{loop.i}}",
                                 "type": "textfield",
                                 "label": "I started my first trip from",
                                 "placeholder": "answer here"
                              },
                              {
                                 "fieldName": "location{{loop.i}}",
                                 "type": "textfield",
                                 "label": "I went to",
                                 "placeholder": "answer here"
                              },
                              {
                                 "fieldName": "locationMunicipality{{loop.i}}",
                                 "type": "textfield",
                                 "label": "Municipality",
                                 "placeholder": "answer here"
                              },
                              {
                                 "fieldName": "startTime{{loop.i}}",
                                 "type": "textfield",
                                 "label": "Start Time",
                                 "placeholder": "answer here"
                              },
                              {
                                 "fieldName": "arrivalTIme{{loop.i}}",
                                 "type": "textfield",
                                 "label": "Arrival time",
                                 "placeholder": "answer here"
                              },
                              {
                                 "fieldName": "tripPurpose{{loop.i}}",
                                 "type": "textfield",
                                 "label": "Trip Purpose",
                                 "placeholder": "answer here"
                              },
                              {
                                 "fieldName": "tripMethod{{loop.i}}",
                                 "type": "textfield",
                                 "label": "Method of travel",
                                 "placeholder": "answer here"
                              },
                              {
                                 "fieldName": "numberOfPeople{{loop.i}}",
                                 "type": "textfield",
                                 "label": "If by auto: Number of people in car",
                                 "placeholder": "answer here"
                              },
                              {
                                 "fieldName": "autoAvaliable{{loop.i}}",
                                 "value": "Some Value",
                                 "type": "checkbox",
                                 "label": "If not by auto: Was an auto available",
                                 "defaultValue": false,
                                 "trueLabel": "Yes",
                                 "falseLabel": "No"
                              }
                           ]
                        },
                        {
                           "fieldName": "hasNextLocation{{loop.i}}",
                           "value": "Some Value",
                           "type": "checkbox",
                           "label": "Add another trip",
                           "defaultValue": false,
                           "trueLabel": "Yes",
                           "falseLabel": "No"
                        }
                     ]
                  }
               ],
               "navigationLogic": "renderer.useFormData();\nif(formData.loop.i<formData.loop.total-1){\n   formData.loop.i++;\n   renderer.setFormValue('loop', formData.loop);\n   return 'cb46d';\n}\nreturn '8f6f3';",
               "then": "goto node 0",
               "nodes": [
                  "8f6f33f3-fd63-4ef4-9ee7-e18c5e0b1f65",
                  "cb46d44e-248c-4297-bcf3-e3955220b7a2"
               ]
            },
            {
               "name": "Thank You",
               "type": "section",
               "uuid": "8f6f33f3-fd63-4ef4-9ee7-e18c5e0b1f65",
               "items": [
                  {
                     "name": "Page One",
                     "type": "set",
                     "items": [
                        {
                           "type": "markdown",
                           "text": "That's it. See you tomorrow "
                        }
                     ]
                  }
               ],
               "navigationLogic": "return 0;",
               "then": "terminate"
            },
            "cb46d44e-248c-4297-bcf3-e3955220b7a2"
         ]
      }
   ]
}